<div class="container">
  <div class="voltar-container">
    <button mat-button (click)="voltar()" class="voltar-button" matTooltip="Voltar à página anterior">
      <mat-icon>arrow_back</mat-icon> Voltar
    </button>
  </div>

  <div *ngIf="carregando" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="loading-text">Carregando detalhes do produto...</p>
  </div>

  <div *ngIf="!carregando && product" class="product-detail">
    <mat-card class="produto-card">
      <div class="produto-grid">
        <div class="produto-imagem">
          <img [src]="product.image" [alt]="product.title" class="produto-img" />
          <div *ngIf="produtoEmPromocao()" class="promocao-badge">
            <span>-{{ calcularDesconto() }}</span>
          </div>
        </div>

        <div class="produto-info">
          <mat-card-header>
            <mat-card-title>{{ product.title }}</mat-card-title>
            <mat-card-subtitle>{{ product.category | titlecase }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="rating-container">
              <div class="stars">
                <mat-icon *ngFor="let star of qtdEstrelas; let i = index" 
                          [ngClass]="getEstrelaClass(i)"
                          matTooltip="{{i+1}} estrelas">
                  {{ getStarIcon(i) }}
                </mat-icon>
              </div>
              <span class="rating-value">{{ product.rating.rate | number:'1.1-1' }}/5</span>
              <span class="reviews-count">({{ product.rating.count }} avaliações)</span>
            </div>

            <mat-divider class="divider"></mat-divider>

            <div class="price-container">
              <h3 class="price" [ngClass]="{'price-original': produtoEmPromocao()}">
                {{ product.price | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </h3>
              
              <h3 *ngIf="produtoEmPromocao()" class="price-promotional">
                {{ precoPromocional() | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </h3>
            </div>

            <p class="description">{{ product.description }}</p>

            <mat-divider class="divider"></mat-divider>

            <div class="actions">
              <button 
                mat-raised-button 
                color="primary" 
                (click)="addToCart()" 
                class="add-to-cart"
                [disabled]="adicionadoAoCarrinho()"
                [matTooltip]="adicionadoAoCarrinho() ? 'Item já está no carrinho' : 'Adicionar ao carrinho'">
                <mat-icon>{{ adicionadoAoCarrinho() ? 'check' : 'add_shopping_cart' }}</mat-icon>
                {{ adicionadoAoCarrinho() ? 'Adicionado ao Carrinho' : 'Adicionar ao Carrinho' }}
              </button>
              
              <button mat-stroked-button color="accent" [routerLink]="['/cart']" *ngIf="adicionadoAoCarrinho()" class="view-cart">
                <mat-icon>shopping_cart</mat-icon>
                Ver Carrinho
              </button>
            </div>

            <mat-chip-set class="chip-list">
              <mat-chip>{{ product.category }}</mat-chip>
              <mat-chip color="accent" *ngIf="product.rating.rate >= 4">Alta Avaliação</mat-chip>
              <mat-chip color="warn" *ngIf="product.rating.count > 200">Popular</mat-chip>
            </mat-chip-set>
          </mat-card-content>
        </div>
      </div>
    </mat-card>
  </div>
</div>
